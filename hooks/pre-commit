#!/bin/bash
# Pre-commit hook to check formatting and clippy

set -e

echo "Running cargo fmt check..."
if ! cargo fmt -- --check; then
    echo "❌ Code is not formatted. Run 'cargo fmt' to fix."
    exit 1
fi

echo "Running cargo clippy..."
if ! cargo clippy --all-targets --message-format=short -- -D warnings; then
    echo "❌ Clippy found warnings. Fix them before committing."
    exit 1
fi

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
echo "Checking EslEventType against C ESL..."
if ! "$SCRIPT_DIR/check-event-types.sh"; then
    echo "❌ EslEventType enum is out of sync with C ESL. Update src/event.rs."
    exit 1
fi

echo "✅ Pre-commit checks passed"
